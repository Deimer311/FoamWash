<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema de Gesti√≥n de Servicios</title>
<link rel="stylesheet" href="./css/estilos_reportes.css">
<style>
    .nav-link {
        font-size: 15px;
        padding: 8px 15px;
        width: 100%;
        text-align: center;
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.1);
    }
</style>
</head>
<body>
<header>
    <h1>Sistema de Gesti√≥n de Servicios</h1>
    <nav>
        <label for="ordenes">Gesti√≥n de √ìrdenes</label>
        <label for="reportes">Reportes y Desempe√±o</label>
        <label><a href="./Perfiladmin.html" class="nav-link">Perfil</a></label>
        <button class="btn-cerrar-sesion" onclick="cerrarSesion()">üö™ Cerrar Sesi√≥n</button>
    </nav>
</header>
<input type="radio" name="menu" id="ordenes" checked>
<input type="radio" name="menu" id="reportes">

<!-- Secci√≥n Gesti√≥n de √ìrdenes -->
<section id="gestion-ordenes" class="content">
    <div class="ordenes-container">
        <h2>√ìrdenes de Servicio</h2>
        <p>Gestiona y da seguimiento a todas las √≥rdenes</p>

        <div class="columns">
            <!-- Pendiente -->
            <div class="col pendiente">
                <h3>Pendiente</h3>
                <div class="card">
                    <h4>Empresa ABC</h4>
                    <span class="badge alta">Alta</span>
                    <span class="badge tipo">Mantenimiento</span>
                    <p class="fecha">üìÖ 19/10/2025</p>
                    <p class="desc">Revisi√≥n completa del sistema el√©ctrico</p>
                    <button class="btn-asignar">üë§ Asignar Personal</button>
                </div>
            </div>

            <!-- En Proceso -->
            <div class="col proceso">
                <h3>En Proceso</h3>
                <div class="card">
                    <h4>Corporaci√≥n XYZ</h4>
                    <span class="badge media">Media</span>
                    <span class="badge tipo">Instalaci√≥n</span>
                    <p class="fecha">üìÖ 20/10/2025</p>
                    <p class="personal">üë§ Juan P√©rez</p>
                    <div class="progreso">
                        <div class="barra" style="width:45%"></div>
                    </div>
                    <p class="desc">Instalaci√≥n de nuevos equipos</p>
                    <button class="btn-completar">Completar</button>
                </div>
            </div>

            <!-- Finalizada -->
            <div class="col finalizada">
                <h3>Finalizada</h3>
                <div class="card">
                    <h4>Tienda Local</h4>
                    <span class="badge baja">Baja</span>
                    <span class="badge tipo">Reparaci√≥n</span>
                    <p class="fecha">üìÖ 21/10/2025</p>
                    <p class="personal">üë§ Mar√≠a Gonz√°lez</p>
                    <p class="desc">Reparaci√≥n menor</p>
                </div>
            </div>
        </div>

        <!-- Historial -->
        <div class="historial">
            <h3>Historial de √ìrdenes</h3>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Cliente</th>
                        <th>Servicio</th>
                        <th>Prioridad</th>
                        <th>Fecha</th>
                        <th>Personal</th>
                        <th>Estado</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>#1</td>
                        <td>Empresa ABC</td>
                        <td>Mantenimiento</td>
                        <td><span class="badge alta">Alta</span></td>
                        <td>19/10/2025</td>
                        <td>Sin asignar</td>
                        <td><span class="estado pendiente">Pendiente</span></td>
                    </tr>
                    <tr>
                        <td>#4</td>
                        <td>Hotel Premium</td>
                        <td>Consultor√≠a</td>
                        <td><span class="badge alta">Alta</span></td>
                        <td>19/10/2025</td>
                        <td>Carlos Ruiz</td>
                        <td><span class="estado proceso">En Proceso</span></td>
                    </tr>
                    <tr>
                        <td>#2</td>
                        <td>Corporaci√≥n XYZ</td>
                        <td>Instalaci√≥n</td>
                        <td><span class="badge media">Media</span></td>
                        <td>20/10/2025</td>
                        <td>Juan P√©rez</td>
                        <td><span class="estado proceso">En Proceso</span></td>
                    </tr>
                    <tr>
                        <td>#3</td>
                        <td>Tienda Local</td>
                        <td>Reparaci√≥n</td>
                        <td><span class="badge baja">Baja</span></td>
                        <td>21/10/2025</td>
                        <td>Mar√≠a Gonz√°lez</td>
                        <td><span class="estado finalizada">Finalizada</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</section>

<!-- Secci√≥n Reportes y Desempe√±o -->
<section id="reportes-desempeno" class="content">
    <h2>Reportes y Desempe√±o</h2>
    <p>An√°lisis y m√©tricas del negocio</p>

    <div class="metrics">
        <div class="metric">Total Reservas<br><strong>156</strong><br><small>+12.5% vs mes anterior</small></div>
        <div class="metric">Servicios Completados<br><strong>98</strong><br><small>+8.3% vs mes anterior</small></div>
        <div class="metric">Ingresos Totales<br><strong>$45.780</strong><br><small>+15.2% vs mes anterior</small></div>
        <div class="metric">Desempe√±o Promedio<br><strong>87.5%</strong><br><small>-2.1% vs mes anterior</small></div>
    </div>

    <div class="charts">
        <div class="chart">
            <h4>Ingresos y Servicios</h4>
            <img src="https://dummyimage.com/400x200/667eea/ffffff&text=Gr√°fica+Ingresos+vs+Servicios" alt="Gr√°fica ingresos">
        </div>
        <div class="chart">
            <h4>Distribuci√≥n por Tipo de Servicio</h4>
            <img src="https://dummyimage.com/300x200/764ba2/ffffff&text=Gr√°fico+de+Pastel" alt="Gr√°fico pastel">
        </div>
    </div>

    <div class="chart">
        <h4>Desempe√±o por Empleado</h4>
        <img src="https://dummyimage.com/500x200/667eea/ffffff&text=Gr√°fico+Barras" alt="Gr√°fico barras">
    </div>

    <div class="insights">
        <div class="alert alerta">‚ö† La productividad del personal ha disminuido 2.1% este mes</div>
        <div class="alert verde">üìà Los ingresos han aumentado 15.2% comparado con el mes anterior</div>
        <div class="alert azul">üîç Alta demanda de servicios de mantenimiento en Zona Norte</div>
    </div>
</section>

<!-- Modal de confirmaci√≥n de cierre de sesi√≥n -->
<div class="modal" id="modalCerrarSesion">
    <div class="modal-content">
        <div class="modal-header">
            <h3>üö™ Cerrar Sesi√≥n</h3>
            <span class="cerrar" onclick="cerrarModal()">‚úñ</span>
        </div>
        <p style="margin: 1.5rem 0;">¬øEst√°s seguro de que deseas cerrar sesi√≥n?</p>
        <div style="display: flex; gap: 1rem; justify-content: flex-end;">
            <button onclick="cerrarModal()" style="padding: 0.7rem 1.5rem; border: none; border-radius: 8px; background: #e0e0e0; cursor: pointer; font-weight: 600;">Cancelar</button>
            <button onclick="confirmarCerrarSesion()" style="padding: 0.7rem 1.5rem; border: none; border-radius: 8px; background: #dc3545; color: white; cursor: pointer; font-weight: 600;">S√≠, cerrar sesi√≥n</button>
        </div>
    </div>
</div>

<!-- Contenedor de notificaciones -->
<div id="notificacionContainer"></div>

<script src="./js/login.js"></script><!-- script de login para sus funcionalidades -->
<script src="./js/sesiones_activas.js"></script><!-- script de las sesiones activas -->
<script>
        // ===================================================================
        // PROTECCI√ìN DE P√ÅGINA - Solo clientes pueden acceder
        // ===================================================================
        const session = protectPage(['admin']);
        
        // Mostrar informaci√≥n del usuario en el header
        if (session && session.email) {
            const userEmailElement = document.getElementById('userEmail');
            if (userEmailElement) {
                userEmailElement.textContent = `üë§ ${session.email}`;
            }
            
            console.log('‚úÖ P√°gina de servicios cargada para:', session.email);
            console.log('üîê Rol:', session.role);
            console.log('üé´ Token:', session.token);
        }
        
        // ===================================================================
        // FUNCI√ìN PARA CERRAR SESI√ìN EN ESTA P√ÅGINA
        // ===================================================================
        function cerrarSesionCliente(e) {
            e.preventDefault();
            
            if (confirm('¬øEst√°s seguro de que deseas cerrar sesi√≥n?')) {
                // Mostrar notificaci√≥n si la funci√≥n existe
                if (typeof mostrarNotificacion === 'function') {
                    mostrarNotificacion('Cerrando sesi√≥n...');
                }
                
                // Cerrar sesi√≥n despu√©s de 1 segundo
                setTimeout(() => {
                    logout(); // Funci√≥n definida en login.js
                }, 1000);
            }
        }
        
        // ===================================================================
        // INFORMACI√ìN DE DEBUG (Opcional - quitar en producci√≥n)
        // ===================================================================
        console.log('üìä Sesiones activas en el sistema:', contarSesionesActivas());
        console.log('üë• Detalles de todas las sesiones:', obtenerSesionesActivas());
    </script>
</body>
</html>