<!--
    PANEL DE TAREAS PARA TRABAJADORES
    Permite ver, gestionar y completar las tareas asignadas
    Incluye sistema de autenticaciÃ³n y gestiÃ³n de sesiones
-->

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mis Tareas - FoamWash Trabajador</title>
    <link rel="stylesheet" href="./css/tareas.css"><!-- hace referencia a los estilos -->
    <style>
        /* ==================estilos adicionaales para las etiquetas A============================ */
        .nav-link {
            font-size: 15px;
            padding: 8px 15px;
            width: 100%;
            text-align: center;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body>
    <!-- ==================== HEADER ==================== -->
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <h1>ğŸ§¼ FoamWash - Panel Trabajador</h1>
                <p>GestiÃ³n de Tareas y Servicios</p>
            </div>
            <div class="user-section">
                <div class="user-info">
                    <div class="user-name" id="userName">Cargando...</div>
                    <div class="user-role">ğŸ‘· Trabajador</div>
                </div>
                <nav>
                    <a href="./Perfiltrabajador.html">Perfil</a>
                </nav>
                <button class="btn-logout" onclick="cerrarSesionTrabajador()">
                    ğŸšª Cerrar SesiÃ³n
                </button>
            </div>
        </div>
    </header>

    <!-- ==================== CONTENEDOR PRINCIPAL ==================== -->
    <div class="container">
        <!-- Panel de EstadÃ­sticas -->
        <div class="stats-panel">
            <div class="stat-card">
                <span class="stat-icon">ğŸ“‹</span>
                <div class="stat-number" id="statTotal">0</div>
                <div class="stat-label">Total Tareas</div>
            </div>
            <div class="stat-card">
                <span class="stat-icon">â³</span>
                <div class="stat-number" id="statPendientes">0</div>
                <div class="stat-label">Pendientes</div>
            </div>
            <div class="stat-card">
                <span class="stat-icon">ğŸ”„</span>
                <div class="stat-number" id="statEnProgreso">0</div>
                <div class="stat-label">En Progreso</div>
            </div>
            <div class="stat-card">
                <span class="stat-icon">âœ…</span>
                <div class="stat-number" id="statCompletadas">0</div>
                <div class="stat-label">Completadas Hoy</div>
            </div>
        </div>

        <!-- Filtros -->
        <div class="filters-section">
            <div class="filter-group">
                <label>Estado</label>
                <select class="filter-select" id="filterEstado" onchange="filtrarTareas()">
                    <option value="todos">Todos</option>
                    <option value="pendiente">Pendientes</option>
                    <option value="en-progreso">En Progreso</option>
                    <option value="completada">Completadas</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Fecha</label>
                <select class="filter-select" id="filterFecha" onchange="filtrarTareas()">
                    <option value="todos">Todas las fechas</option>
                    <option value="hoy">Hoy</option>
                    <option value="manana">MaÃ±ana</option>
                    <option value="semana">Esta Semana</option>
                </select>
            </div>
            <button class="btn-refresh" onclick="cargarTareas()">
                ğŸ”„ Actualizar
            </button>
        </div>

        <!-- Lista de Tareas -->
        <div class="tasks-section">
            <div class="section-header">
                <h2 class="section-title">Mis Tareas Asignadas</h2>
                <span class="tasks-count" id="tasksCount">0 tareas</span>
            </div>
            <div class="tasks-grid" id="tasksGrid">
                <!-- Las tareas se cargarÃ¡n dinÃ¡micamente -->
            </div>
        </div>
    </div>

    <!-- Modal de Detalles -->
    <div class="modal-overlay" id="modalDetalles">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ“‹ Detalles de la Tarea</h2>
                <button class="modal-close" onclick="cerrarModal()">Ã—</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Contenido dinÃ¡mico -->
            </div>
        </div>
    </div>

    <!-- Contenedor de Notificaciones -->
    <div id="notificacionContainer"></div>

    <!-- ==================== SCRIPTS ==================== -->
    
    <!-- 1. Sistema de autenticaciÃ³n -->
    <script src="./js/login.js"></script>
    
    <!-- 2. Sistema de sesiones -->
    <script src="../js/sesiones_activas.js"></script>

    <!-- 3. protecion de la pagina -->
    <script>
        // ===================================================================
        // PROTECCIÃ“N DE PÃGINA - Solo clientes pueden acceder
        // ===================================================================
        const session = protectPage(['trabajador']); // FunciÃ³n definida en login.js
        
        // Mostrar informaciÃ³n del usuario en el header
        if (session && session.email) {
            const userEmailElement = document.getElementById('userEmail');
            if (userEmailElement) {
                userEmailElement.textContent = `ğŸ‘¤ ${session.email}`;
            }
            
            console.log('âœ… PÃ¡gina de servicios cargada para:', session.email);
            console.log('ğŸ” Rol:', session.role);
            console.log('ğŸ« Token:', session.token);
        }
    </script>
    <!-- 4. LÃ³gica de tareas -->
    <script src="./js/tareas.js"></script>

    <!-- 5. Script de Cierre de SesiÃ³n -->
    <script>
        // ===================================================================
        // FUNCIÃ“N PARA CERRAR SESIÃ“N EN ESTA PÃGINA
        // ===================================================================
        function cerrarSesionTrabajador() {
            if (confirm('Â¿EstÃ¡s seguro de que deseas cerrar sesiÃ³n?')) {
                // Mostrar notificaciÃ³n si la funciÃ³n existe
                if (typeof mostrarNotificacion === 'function') {
                    mostrarNotificacion('Cerrando sesiÃ³n...');
                }
                
                // Cerrar sesiÃ³n despuÃ©s de 1 segundo
                setTimeout(() => {
                    logout(); // FunciÃ³n definida en login.js
                }, 1000);
            }
        }
        
        // ===================================================================
        // INFORMACIÃ“N DE DEBUG (Opcional - quitar en producciÃ³n)
        // ===================================================================
        console.log('ğŸ“Š Sesiones activas en el sistema:', contarSesionesActivas());
        console.log('ğŸ‘¥ Detalles de todas las sesiones:', obtenerSesionesActivas());
    </script>
</body>
</html>